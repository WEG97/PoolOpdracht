<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Your first three.js project</title>
        <style>
            body {
                width: 100%;
                height: 100%;
                margin: 0px;
            }
        </style>
    </head>
    <body>
        <script src="js/three.min.js"></script>
        <script>
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000);
            document.body.appendChild(renderer.domElement);

            var cGeometry = new THREE.BoxGeometry(1,1,1);
            var cMaterial = new THREE.MeshPhongMaterial({color:0xf0f0f0});
            var cube = new THREE.Mesh(cGeometry,cMaterial);
            cube.position.z = -15;
            scene.add(cube);

            var cGroup = new THREE.Group();
            scene.add(cGroup);

            var LGeometry = new THREE.BoxGeometry(1,1,6);
            var LMaterial = new THREE.MeshPhongMaterial({color:0x00ff00});
            var LongCube = new THREE.Mesh(LGeometry,LMaterial);
            LongCube.position.z = -15;
            LongCube.position.x = -15;
            cGroup.add(LongCube);
            var clonedLongCube = LongCube.clone();
            clonedLongCube.position.x = 15;
            cGroup.add(clonedLongCube);

            var raycaster = new THREE.Raycaster();

            var groundMaterial = new THREE.MeshPhongMaterial({color:0xf0f0f0});
            var ground = new THREE.Mesh(new THREE.PlaneBufferGeometry(100,100,2,2), groundMaterial);
            ground.position.y = -2;
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            var cubeDirection = new THREE.Vector3();
            cubeDirection.x = -1;
            cubeDirection.normalize();

            var speed = new THREE.Vector3();
            var clock = new THREE.Clock();

            var blueMaterial = new THREE.MeshPhongMaterial({color:0x0040ff});
            var greenMaterial = new THREE.MeshPhongMaterial({color:0x00ff00});

            var rotationPerFrame = 0.05;
            var rotationVector = new THREE.Vector3(rotationPerFrame, rotationPerFrame, rotationPerFrame);

            scene.add(new THREE.AmbientLight(0x111111));

            var sphere = new THREE.SphereGeometry(0.5, 16, 8);

            var light1 = new THREE.PointLight(0xff0040, 1.5, 100);
            light1.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({color:0xff0040})));
            light1.position.set(0, 4, -15);
            scene.add(light1);

            var light2 = new THREE.PointLight(0xf0f0f0, 0.5, 100);
            light2.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({color:0xf0f0f0})));
            light2.position.set(-15, 4, -15);
            scene.add(light2);

            var light3 = new THREE.PointLight(0xf0f0f0, 1.5, 100);
            light3.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({color:0xf0f0f0})));
            light3.position.set(15, 4, -15);
            scene.add(light3);

            function render() {
                requestAnimationFrame(render);

                //cube.rotation.setFromVector3(cube.rotation.toVector3.add(rotationVector)); //werkt niet verkeerd voorbeeld??
                cube.rotation.x += rotationPerFrame;
                cube.rotation.y += rotationPerFrame;
                cube.rotation.z += rotationPerFrame;

                cube.position.add(speed.copy(cubeDirection).multiplyScalar(clock.getDelta()*20));
                raycaster.set(cube.position, cubeDirection);
                var intersections = raycaster.intersectObjects(cGroup.children);

                if(intersections.length > 0){
                    var intersection = intersections[0];

                    if(intersection.distance < 2){
                        cubeDirection.reflect(intersection.face.normal);
                    }
                }

                for(var name in cGroup.children){
                    var currentElement = cGroup.children[name];
                    currentElement.material = blueMaterial;
                }

                raycaster.setFromCamera(mouse, camera);

                var mouseIntersections = raycaster.intersectObjects(cGroup.children);

                if(mouseIntersections.length > 0){
                    var intersection = mouseIntersections[0];
                    intersection.object.material = greenMaterial;
                }

                renderer.render(scene, camera);
            }

            var mouse = new THREE.Vector2();
            document.addEventListener('mousemove', onDocumentMouseMove, false);

            function onDocumentMouseMove(event){
                event.preventDefault();

                mouse.x = (event.clientX/window.innerWidth)*2-1;
                mouse.y = - (event.clientY/window.innerHeight)*2+1;
            }

            camera.position.y = 10;
            camera.lookAt(cube.position);

            render();
        </script>
    </body>
</html>